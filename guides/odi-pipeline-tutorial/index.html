<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="The Industry Toolkit is a collection of assets that enable application development and support teams to deliver business value to Industry 4.0 partners and clients. The toolkit includes assets like Ansible artifacts, code patterns, tutorials, reference architectures and best practices."><meta name=author content="IBM Build Labs Industry"><link href=https://remkohdev.github.io/industry-toolkit/guides/odi-pipeline-tutorial/ rel=canonical><link rel=icon href=../../images/cloudnativetoolkit.png><meta name=generator content="mkdocs-1.2.1, mkdocs-material-7.1.8"><title>ODI Pipeline - Industry Toolkit</title><link rel=stylesheet href=../../assets/stylesheets/main.ca7ac06f.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.f1a3b89f.min.css><meta name=theme-color content=#000000><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=IBM+Plex+Sans:300,400,400i,700%7CIBM+Plex+Mono&display=fallback"><style>:root{--md-text-font-family:"IBM Plex Sans";--md-code-font-family:"IBM Plex Mono"}</style><link rel=stylesheet href=../../css/extra.css><link rel=stylesheet href=../../css/toolkit-code.css><script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-153689700-1","auto"),ga("set","anonymizeIp",!0),ga("send","pageview"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){var e;this.value&&(e=document.location.pathname,ga("send","pageview",e+"?q="+this.value))}),"undefined"!=typeof location$&&location$.subscribe(function(e){ga("send","pageview",e.pathname)})})</script><script async src=https://www.google-analytics.com/analytics.js></script><!-- Determine title --><!-- The image needs to have an absolute URL --><!-- Open graph meta tags --><meta property=og:type content=website><meta property=og:title content="Industry Toolkit - ODI Pipeline"><meta property=og:description content="The Industry Toolkit is a collection of assets that enable application development and support teams to deliver business value to Industry 4.0 partners and clients. The toolkit includes assets like Ansible artifacts, code patterns, tutorials, reference architectures and best practices."><meta content=https://remkohdev.github.io/industry-toolkit/guides/odi-pipeline-tutorial/ property=og:url><meta property=og:image content=https://remkohdev.github.io/industry-toolkit/assets/images/banner.png><meta property=og:image:type content=image/png><meta property=og:image:width content=1080><meta property=og:image:height content=568></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=black data-md-color-accent> <script>function __prefix(e){return new URL("../..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#odi-pipeline class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../.. title="Industry Toolkit" class="md-header__button md-logo" aria-label="Industry Toolkit" data-md-component=logo> <img src=../../images/cloudnativetoolkit.png alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Industry Toolkit </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> ODI Pipeline </span> </div> </div> </div> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query data-md-state=active required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </label> <button type=reset class="md-search__icon md-icon" aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg> </button> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/remkohdev/industry-toolkit/ title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <!-- Determine class according to configuration --> <!-- Main navigation --> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <!-- Site title --> <!--
  <label class="md-nav__title" for="__drawer">
    <a
      href="../.."
      title="Industry Toolkit"
      class="md-nav__button md-logo"
      aria-label="Industry Toolkit"
      data-md-component="logo"
    >
      
  <img src="../../images/cloudnativetoolkit.png" alt="logo">

    </a>
    Industry Toolkit
  </label>
--> <!-- Repository information --> <div class=md-nav__source> <a href=https://github.com/remkohdev/industry-toolkit/ title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> </div> </a> </div> <!-- Render item list --> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> Home </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2 type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2> Overview <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Overview data-md-level=1> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Overview </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../overview/overview/ class=md-nav__link> What is the Industry Toolkit </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3 type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3> Use Cases <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Use Cases" data-md-level=1> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Use Cases </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../use-cases/edge-data-gateway/ class=md-nav__link> Edge Data Gateway </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4 type=checkbox id=__nav_4 checked> <label class=md-nav__link for=__nav_4> Guides <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Guides data-md-level=1> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Guides </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> ODI Pipeline <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> ODI Pipeline </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#quick-setup class=md-nav__link> Quick Setup </a> <nav class=md-nav aria-label="Quick Setup"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#installing-deploy-master-with-odi-instance class=md-nav__link> Installing Deploy master with ODI instance </a> </li> <li class=md-nav__item> <a href=#deploy-setup-for-remote-cluster class=md-nav__link> Deploy setup for remote cluster </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#using-deploy-automation-components class=md-nav__link> Using Deploy Automation components </a> <nav class=md-nav aria-label="Using Deploy Automation components"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#installer-image-setup class=md-nav__link> Installer image setup </a> </li> <li class=md-nav__item> <a href=#pipelines class=md-nav__link> Pipelines </a> </li> <li class=md-nav__item> <a href=#manual-installation class=md-nav__link> Manual installation </a> </li> <li class=md-nav__item> <a href=#cluster-provisioning class=md-nav__link> Cluster Provisioning </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#environments class=md-nav__link> Environments </a> </li> <li class=md-nav__item> <a href=#getting-pipeline-backup-logs-on-local class=md-nav__link> Getting Pipeline backup logs on local </a> </li> <li class=md-nav__item> <a href=#using-buildconfig-to-build-installerdeployer-images class=md-nav__link> Using BuildConfig to build installer/deployer images </a> <nav class=md-nav aria-label="Using BuildConfig to build installer/deployer images"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#setup-buildconfigs-for-dev-or-integration-clusters class=md-nav__link> Setup buildconfigs for Dev or Integration clusters </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#quick-setup class=md-nav__link> Quick Setup </a> <nav class=md-nav aria-label="Quick Setup"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#installing-deploy-master-with-odi-instance class=md-nav__link> Installing Deploy master with ODI instance </a> </li> <li class=md-nav__item> <a href=#deploy-setup-for-remote-cluster class=md-nav__link> Deploy setup for remote cluster </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#using-deploy-automation-components class=md-nav__link> Using Deploy Automation components </a> <nav class=md-nav aria-label="Using Deploy Automation components"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#installer-image-setup class=md-nav__link> Installer image setup </a> </li> <li class=md-nav__item> <a href=#pipelines class=md-nav__link> Pipelines </a> </li> <li class=md-nav__item> <a href=#manual-installation class=md-nav__link> Manual installation </a> </li> <li class=md-nav__item> <a href=#cluster-provisioning class=md-nav__link> Cluster Provisioning </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#environments class=md-nav__link> Environments </a> </li> <li class=md-nav__item> <a href=#getting-pipeline-backup-logs-on-local class=md-nav__link> Getting Pipeline backup logs on local </a> </li> <li class=md-nav__item> <a href=#using-buildconfig-to-build-installerdeployer-images class=md-nav__link> Using BuildConfig to build installer/deployer images </a> <nav class=md-nav aria-label="Using BuildConfig to build installer/deployer images"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#setup-buildconfigs-for-dev-or-integration-clusters class=md-nav__link> Setup buildconfigs for Dev or Integration clusters </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/remkohdev/industry-toolkit/edit/main/docs/guides/odi-pipeline-tutorial.md title="Edit this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg> </a> <h1 id=odi-pipeline>ODI Pipeline<a class=headerlink href=#odi-pipeline title="Permanent link">&para;</a></h1> <h2 id=quick-setup>Quick Setup<a class=headerlink href=#quick-setup title="Permanent link">&para;</a></h2> <p>Using the information descried in the previous section, a quick setup can be performed by running the <code>setup</code> script with the appropriate values defined in the pipeline properties file. The steps are described below in detail.</p> <h3 id=installing-deploy-master-with-odi-instance>Installing Deploy master with ODI instance<a class=headerlink href=#installing-deploy-master-with-odi-instance title="Permanent link">&para;</a></h3> <p>Extract the deployer tar package on the client machine. Log into the cluster where the pipeline should get deployed. Then proceed with the steps listed below:</p> <ol> <li>Move to the setup directory, <code>cd pipeline/setup</code></li> <li>Create a copy from the properties template file. <code>cp pipeline-properties.template pipeline-&lt;cluster-name&gt;.properties</code></li> <li>Replace the property variables with appropriate value as described in the table below:</li> </ol> <table> <thead> <tr> <th>Property</th> <th>Description</th> <th>Example value</th> </tr> </thead> <tbody> <tr> <td><code>odi.release</code></td> <td>ODI release version</td> <td><code>v2.0.4</code> also use as the version tag for the installer images.</td> </tr> <tr> <td><code>repo.public</code></td> <td>Name of the repo file for the GA entitlements.</td> <td><code>repo-public.yaml</code></td> </tr> <tr> <td><code>repo.staging</code></td> <td>Name of the repo file for the Staging area entitlements.</td> <td><code>repo-staging.yaml</code></td> </tr> <tr> <td><code>cluster.login.secret.name</code></td> <td>Cluster login secret used by the pipeline.</td> <td><code>&lt;cluster&gt;-login-secret</code></td> </tr> <tr> <td><code>imagepull.registry.key</code></td> <td>Installer container image name.</td> <td><code>us.icr.io/odi-stg/odi-installer</code></td> </tr> <tr> <td><code>deploy.namespace</code></td> <td>Namespace where pipeline will deploy.</td> <td><code>odi-deploy</code></td> </tr> <tr> <td><code>deploy.service.account</code></td> <td>Name of the service account used by the pipeline.</td> <td><code>odi-deployer</code></td> </tr> <tr> <td><code>deploy.file.storage</code></td> <td>Storage class used by pipeline and the OSDU component</td> <td><code>ibmc-file-gold</code></td> </tr> <tr> <td><code>deploy.block.storage</code></td> <td>Name of the repo file for the GA entitlements.</td> <td><code>ibmc-block-gold</code></td> </tr> <tr> <td><code>cluster.shortname</code></td> <td>Name of the repo file for the GA entitlements.</td> <td><code>cluster-shortname</code></td> </tr> <tr> <td><code>login.type</code></td> <td>Mode of authentication password or token.</td> <td><code>token</code></td> </tr> <tr> <td><code>pipeline.run.yaml</code></td> <td>Area that pipeline should use for the deploy.</td> <td><code>repo-public.yaml</code></td> </tr> <tr> <td><code>cpd.version</code></td> <td>Based Cloud Pak for Data version used by <code>cpd-cli</code>.</td> <td><code>3.5.4</code></td> </tr> <tr> <td><code>odi.install.namespace</code></td> <td>ODI install namespace.</td> <td><code>osdu</code></td> </tr> <tr> <td><code>hardware.arch</code></td> <td>Install hardware architecture.</td> <td><code>x86_64</code></td> </tr> <tr> <td><code>external.cert.required</code></td> <td>Mode of authentication password or token.</td> <td><code>"No"</code></td> </tr> </tbody> </table> <ol> <li>Copy the repo yaml files into the setup directory. </li> <li>Run the setup script. <code>./setup.sh pipeline-&lt;cluster-name&gt;.properties all | tee pipeline-&lt;cluster-name&gt;-install.log</code> This should install the pipeline under the specified project and create the pipeline run manifests under <code>../runs/&lt;cluster-name&gt;</code> directory.</li> <li>To upgrade the version of ODI, <code>cd ./runs/&lt;cluster-name&gt;; upgradeODI.sh</code></li> </ol> <h3 id=deploy-setup-for-remote-cluster>Deploy setup for remote cluster<a class=headerlink href=#deploy-setup-for-remote-cluster title="Permanent link">&para;</a></h3> <p>Setting up remote cluster is a two step process. Login to the target cluster using admin credentials. Then proceed with the steps listed below:</p> <ol> <li>Create a copy from the properties template file to represent the target cluster. <code>cp pipeline-properties.template pipeline-&lt;cluster-name&gt;.properties</code></li> <li>Move to the setup directory, <code>cd pipeline/setup</code></li> <li>Run the setup script. <code>./setup.sh pipeline-&lt;cluster-name&gt;.properties setup-target | tee pipeline-&lt;cluster-name&gt;-target-install.log</code>. This sets up the service account and image pull secrets under the odi deploy namespace.</li> <li>Note that the pipeline run manifests are generated under <code>../runs/&lt;cluster-name&gt;</code> directory.</li> </ol> <p>Now, switch to the master deploy cluster and setup the remote cluster configuration. Login to the master cluster using admin credentials.</p> <ol> <li>Run the setup script. <code>./setup.sh pipeline-&lt;cluster-name&gt;.properties setup-remote | tee pipeline-&lt;cluster-name&gt;-remote-install.log</code>. This sets up the the login secret and (optionally) repo configs under the odi deploy namespace.</li> <li>To upgrade the version of ODI, <code>cd ./runs/&lt;cluster-name&gt;; upgradeODI.sh</code></li> </ol> <h2 id=using-deploy-automation-components>Using Deploy Automation components<a class=headerlink href=#using-deploy-automation-components title="Permanent link">&para;</a></h2> <h3 id=installer-image-setup>Installer image setup<a class=headerlink href=#installer-image-setup title="Permanent link">&para;</a></h3> <p>Follow these steps to create an ODI installer image.</p> <ol> <li> <p>Clone the repo <code>git@github.ibm.com:osdu/odi-deploy-automation.git</code> and <code>cd pipeline/ci-cd</code>.</p> </li> <li> <p>This folder contains build-image-pipeline.properties template which needs to be updated with the relevant parameters as below.</p> </li> </ol> <table> <thead> <tr> <th>Property</th> <th>Description</th> <th>Example value</th> </tr> </thead> <tbody> <tr> <td><code>installer.image</code></td> <td>Installer container image name.</td> <td><code>us.icr.io/odi-stg/odi-installer</code></td> </tr> <tr> <td><code>deployer.image</code></td> <td>Deployer container image name.</td> <td><code>us.icr.io/odi-stg/odi-deployer</code></td> </tr> <tr> <td><code>gitreadonlyaccestoken</code></td> <td>Git PAT token from github.</td> <td><code>******</code></td> </tr> <tr> <td><code>username</code></td> <td>IBM-SLB write secret username.</td> <td><code>******</code></td> </tr> <tr> <td><code>apikey</code></td> <td>IBM-SLB write secret apikey.</td> <td><code>******</code></td> </tr> </tbody> </table> <ol> <li> <p>Login into the cluster where this pipeline will be created.</p> </li> <li> <p>Run the command <code>create_config.sh</code> which will create the namespace, service account, PVC, secret, tekton tasks and pipeline. </p> </li> <li> <p>Run the command <code>build_installer_pipelinerun.sh &lt;image-tag&gt;</code> with appropriate image tag with which the pipeline run needs to be created.</p> </li> <li> <p>After this, it will trigger this pipeline with the help of pipelinerun (build-installer-image-pipeline-run.yaml). The container image is then pushed to the image registry <code>us.icr.io/odi-stg/</code> with the latest tag.</p> </li> </ol> <p>Use the installer image for manual installation of the ODI as described in the <code>Manual install</code> section.</p> <h3 id=pipelines>Pipelines<a class=headerlink href=#pipelines title="Permanent link">&para;</a></h3> <p>Manifests for Tekton constructs are under the <code>/pipeline/manifests</code> directory. These yaml files create the tasks and pipelines.</p> <table> <thead> <tr> <th>Pipeline</th> <th>Description</th> <th>Supporting tasks</th> </tr> </thead> <tbody> <tr> <td><code>login-pipeline</code></td> <td>Sets up login context for deploy and target clusters</td> <td><code>login-task</code></td> </tr> <tr> <td><code>uninstall-odi-pipeline</code></td> <td>Uninstalls ODI instance</td> <td><code>uninstall-odi</code></td> </tr> <tr> <td><code>install-odi-prereqs-pipeline</code></td> <td>Installs ODI prereqs</td> <td><code>install-odi-prereqs</code></td> </tr> <tr> <td><code>install-control-plane-pipeline</code></td> <td>Sets up CPD service accounts</td> <td><code>install-cpd-control-plane</code></td> </tr> <tr> <td><code>install-osdu-pipeline</code></td> <td>Installs adm lite and OSDU</td> <td><code>install-osdu</code></td> </tr> <tr> <td><code>run-post-install-pipeline</code></td> <td>Runs post install script</td> <td><code>run-post-install-script</code></td> </tr> <tr> <td><code>run-sanity-test-pipeline</code></td> <td>Runs sanity test</td> <td><code>run-sanity-test</code></td> </tr> <tr> <td><code>install-validate-pipeline</code></td> <td>Validates installation</td> <td><code>run-sanity-test, run-postman-collection</code></td> </tr> <tr> <td><code>upgrade-odi-pipeline</code></td> <td>Sets up login context for deploy and target clusters</td> <td><code>login-task, uninstall-odi, install-odi-prereqs, install-cpd-control-plane, install-osdu, run-post-install-script</code></td> </tr> </tbody> </table> <h4 id=pipeline-runs>Pipeline runs<a class=headerlink href=#pipeline-runs title="Permanent link">&para;</a></h4> <p>Pipeline runs manage the execution of pipelines across various clusters. Pipeline runs are generated per cluster and kept under the <code>pipeline/runs</code> directory.</p> <h4 id=commands>Commands<a class=headerlink href=#commands title="Permanent link">&para;</a></h4> <ul> <li> <p><code>installOpenShiftPipeline.sh</code> Installs OpenShift pipelines operator</p> </li> <li> <p><code>installODIDeployPipeline.sh</code> Installs ODI pipeline deploy artifacts.</p> </li> <li> <p><code>createServiceAccount.sh</code> Sets up the remote cluster for ODI deploy. Creates the namespace and the service account.</p> </li> <li> <p><code>uninstallPipeline.sh</code> Uninstalls deploy artifacts, deletes the pipeline namespace and uninstalls the pipeline operator.</p> </li> </ul> <h4 id=building-the-deployer-image>Building the deployer image<a class=headerlink href=#building-the-deployer-image title="Permanent link">&para;</a></h4> <p>Follow these steps to create an ODI deployer image.</p> <ol> <li> <p>Clone the repo <code>git@github.ibm.com:osdu/odi-deploy-automation.git</code> and <code>cd pipeline/ci-cd</code>.</p> </li> <li> <p>This folder contains build-image-pipeline.properties template which needs to be updated with the relevant parameters.</p> </li> <li> <p>Login into the cluster where this pipeline will be created.</p> </li> <li> <p>Run the command <code>create_config.sh</code> which will create the namespace, service account, PVC, secret, tekton tasks and pipeline. </p> </li> <li> <p>Run the command <code>build_deployer_pipelinerun.sh &lt;image-tag&gt;</code> with appropriate image tag with which the pipeline run needs to be created.</p> </li> <li> <p>After this, it will trigger this pipeline with the help of pipelinerun (build-deployer-image-pipeline-run.yaml). The container image is then pushed to the image registry <code>us.icr.io/odi-stg/</code> with the latest tag.</p> </li> </ol> <h4 id=running-the-pipelines-using-the-tekton-cli>Running the pipelines using the Tekton CLI.<a class=headerlink href=#running-the-pipelines-using-the-tekton-cli title="Permanent link">&para;</a></h4> <p>More information <a href=UsingTknCLI.md>here</a>.</p> <h4 id=uninstalling-pipeline>Uninstalling pipeline<a class=headerlink href=#uninstalling-pipeline title="Permanent link">&para;</a></h4> <p>Uninstalling pipeline deletes the <code>odi-deploy</code> namespace and uninstalls the OpenShift pipelines operator. Run the commands listed below:</p> <p><code>cd setup; uninstallPipeline.sh</code></p> <h3 id=manual-installation>Manual installation<a class=headerlink href=#manual-installation title="Permanent link">&para;</a></h3> <p>Un-tar the deployer package or get the docker image to run a manual installation. </p> <p>Login to the registry <code>us.icr.io</code> using the ready key and then run the following command to setup the install client using the docker container.</p> <p><code>docker run -it us.icr.io/odi-stg/odi-installer:&lt;version&gt; bash</code></p> <p>Install ODI using the script <code>cd installer; ./installODI.sh</code></p> <h3 id=cluster-provisioning>Cluster Provisioning<a class=headerlink href=#cluster-provisioning title="Permanent link">&para;</a></h3> <p>This package provides a setup of Terraform scripts to provision an OpenShift cluster in IBM Cloud with the specifications required to deploy an ODI instance.</p> <p>Steps to follow:</p> <ol> <li>Setup the variables.</li> <li>Run the command <code>terraform plan</code></li> <li>Review the infrastructure items that will get created. Run <code>terraform apply</code></li> </ol> <h2 id=environments>Environments<a class=headerlink href=#environments title="Permanent link">&para;</a></h2> <p>Follow this <a href=Environments.md>link</a> to view all the environments managed by the deploy pipeline.</p> <h2 id=getting-pipeline-backup-logs-on-local>Getting Pipeline backup logs on local<a class=headerlink href=#getting-pipeline-backup-logs-on-local title="Permanent link">&para;</a></h2> <ol> <li>Go to the setup directory.</li> <li>Run the script <code>./copy-backup-local.sh PIPELINE_RUN_NAME</code></li> <li>This will create a tar file i.e backup-log-files.tar which contains logs for a particular Pipeline-run.</li> </ol> <h2 id=using-buildconfig-to-build-installerdeployer-images>Using BuildConfig to build installer/deployer images<a class=headerlink href=#using-buildconfig-to-build-installerdeployer-images title="Permanent link">&para;</a></h2> <h3 id=setup-buildconfigs-for-dev-or-integration-clusters>Setup buildconfigs for Dev or Integration clusters<a class=headerlink href=#setup-buildconfigs-for-dev-or-integration-clusters title="Permanent link">&para;</a></h3> <ol> <li>Run the script <code>setupBuildConfigforDev.sh</code> passing the respective values i.e.., BRANCH_NAME of the repo OR TAG for the image, base64 encoded username and password for the git source clone</li> <li>This will create the namespace, ImageStreams, secrets and buildConfigs for building installer and deployer images. </li> <li>Once the buildConfigs for installer and deployer images are created, OpenShift will create a new build for the respective buildConfigs and pushed to the internal registry.</li> <li> <p>Now for auto-triggering the builds for consecutive git pushes, please follow the below steps:</p> </li> <li> <p>After creating a BuildConfig from a GitHub repository, run: oc describe bc/<name-of-your-buildconfig> -n ci-cd | awk '/webhooks/ {print $2}' This generates a generic webhook GitHub URL Also run the below command for retrieving the webhook secret name oc get bc/<name-of-your-buildconfig> -o=jsonpath='{.spec.triggers..github.secret}' -n ci-cd</p> </li> </ol> <p>Either copy the entire webhook URL with the secret name in it by replacing the <secret> in webhook generic URL from the above commands OR you can Copy URL with secret in the details of the buildConfig for installer or deployer buildConfig in the OpenShift cluster UI</p> <p>Adding the OpenShift created webhook URL to GitHub Now this webhook URL with the webhook secret name in it must be added to the hooks in GitHub setting on which repository the trigger for webhook is configured to. </p> <p>For creating a new hook on Github, go to the settings in the repository, go to the hooks, click on add a webhook, paste the webhook URL in the payload URL which can be retrieved from the above steps, change the content type to application/json, add the webhook secret created from the above steps and then click on add webhook.</p> <p>Unique webhooks for installer buildConfig and deployer buildConfig must be created so that whenever a git push happens to the given branch in buildConfig, unique payloads will be sent to both the installer and deployer build configs.</p> </article> </div> </div> </main> <!-- Footer --> <footer class=md-footer> <!-- Further information --> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-column> <div class=md-footer-text><a href=https://cloudnativetoolkit.dev/contribute/contribute/ >Contribute</a> to the Cloud-Native Toolkit</div> <div class=md-footer-text>Site licensed under <a href=https://creativecommons.org/licenses/by-nc-sa/4.0/ >CC BY-NC-SA 4.0</a></div> </div> <div class=md-footer-column> <div class=md-footer-text>Have questions? open an issue on <a href=https://github.com/cloud-native-toolkit/planning/issues/new/choose>GitHub</a>.</div> <!-- Copyright and theme information --> <div class=md-footer-text> Copyright © 2021 Cloud-Native Toolkit </div> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../..", "features": ["navigation.instant", "navigation.tracking"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../assets/javascripts/workers/search.b0710199.min.js", "version": null}</script> <script src=../../assets/javascripts/bundle.76f349be.min.js></script> </body> </html>